<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>APA Hotel Woodbridge IG & FB 自動回覆機器人技術文件</title>
  <style>
    :root {
  /* Colors */
  --primary: #005ab5; /* 提高對比度 */
  --text: #222; /* 增強可讀性 */
  --bg: #fafafa;
  --white: #fff;
  --gray: #444; /* 提升可讀性 */
  --light-gray: #bbb; /* 更柔和的邊框色 */
  --code-bg: #1e1e1e;
  --code-text: #eaeaea;
  
  /* Font sizes - using clamp for responsiveness */
  --fs-h1: clamp(1.75rem, 5vw, 2.75rem);
  --fs-h2: clamp(1.4rem, 4vw, 2.25rem); 
  --fs-h3: clamp(1.2rem, 3vw, 2rem);
  --fs-body: clamp(1rem, 2vw, 1.1rem);
  
  /* Spacing */
  --spacing-xs: clamp(0.5rem, 1vw, 1rem);
  --spacing-sm: clamp(1rem, 2vw, 1.5rem);
  --spacing-md: clamp(1.5rem, 3vw, 2.5rem); 
  --spacing-lg: clamp(2rem, 4vw, 3.5rem);
}

/* Base styles */
*,
*::before,
*::after {
  box-sizing: border-box; /* 避免 padding 影響尺寸 */
}

body {
  font-family: "Noto Sans TC", "Noto Sans JP", "Noto Sans", sans-serif;
  max-width: min(1100px, 92%);
  margin: var(--spacing-sm) auto;
  padding: 0 var(--spacing-sm);
  line-height: 1.7;
  background: var(--bg);
  color: var(--text);
  font-size: var(--fs-body);
}

h1 {
  font-size: var(--fs-h1);
  color: var(--primary);
  margin-bottom: var(--spacing-lg);
  line-height: 1.3;
}

h2, h3 {
  font-size: var(--fs-h2);
  color: var(--primary);
  margin: var(--spacing-md) 0 var(--spacing-sm);
}

pre {
  background: var(--code-bg);
  color: var(--code-text);
  padding: var(--spacing-sm);
  overflow-x: auto;
  border-radius: 5px;
  font-size: 1em;
  -webkit-overflow-scrolling: touch;
}

/* Table styling */
.table-scroll-wrapper {
  overflow-x: auto;
  background: var(--white);
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  margin-bottom: var(--spacing-lg);
  padding: var(--spacing-sm) 0;
  -webkit-overflow-scrolling: touch;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin: var(--spacing-sm) 0;
  font-size: 1rem;
}

th, td {
  border: 1px solid var(--light-gray);
  padding: var(--spacing-xs);
  text-align: left;
  min-width: 100px;
}

th {
  background-color: var(--primary);
  color: var(--white);
}

@media (max-width: 768px) {
  table {
    font-size: 0.95rem;
  }
  
  .table-scroll-wrapper {
    margin: 0 calc(var(--spacing-sm) * -1);
    border-radius: 0;
  }
}

/* Links */
a {
  color: var(--primary);
  text-decoration: none;
  transition: all 0.2s ease-in-out;
}

a:hover {
  text-decoration: underline;
  opacity: 0.85;
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #1a1a1a;
    --text: #e6e6e6;
    --gray: #bbb;
    --light-gray: #555;
  }
  
  pre {
    background: #121212;
    color: #f5f5f5;
  }
  
  .table-scroll-wrapper {
    background: #2a2a2a;
  }
  
  .lang-tab {
    background: #303030;
  }
  
  .lang-tab.active {
    background: #404040;
  }
}
  </style>
</head>
<body>
  <!-- 語言切換標籤 -->
  <div style="margin-bottom: 20px;">
    <button class="lang-tab active" data-lang="zh">中文</button>
    <button class="lang-tab" data-lang="en">English</button>
    <button class="lang-tab" data-lang="jp">日本語</button>
  </div>

  <!-- 中文內容 -->
  <div class="lang-content active" id="lang-zh">
    <h1>APA Hotel Woodbridge Instagram & Facebook 自動回覆機器人技術文件</h1>
    <section>
      <h2>目的</h2>
      <p>打造一個可自動回覆 IG 和 Facebook 訊息的多語言聊天機器人，服務 APA Hotel Woodbridge 粉絲與潛在顧客。</p>
    </section>
    <section>
      <h2>系統功能概述</h2>
      <ul>
        <li>支援平台：Instagram + Facebook Messenger</li>
        <li>語言支援：中文、英文、日文（自動判斷）</li>
        <li>功能內容：
          <ul>
            <li>回覆訂房連結</li>
            <li>回覆飯店地址</li>
            <li>回覆入住/退房時間</li>
            <li>回覆一般感謝語</li>
          </ul>
        </li>
      </ul>
    </section>
    <section>
      <h2>架構與技術</h2>
      <ul>
        <li>語言：Python</li>
        <li>Web 框架：Flask</li>
        <li>伺服器部署：Render</li>
        <li>使用 Facebook Graph API</li>
        <li>使用 Webhook 接收訊息事件</li>
      </ul>
    </section>
    <section>
      <h2>檔案結構</h2>
      <pre>
project/
├── webhook.py            # 主程式
├── .env                  # 環境變數
└── requirements.txt      # 套件清單（供 Render 使用）
      </pre>
    </section>
    <section>
      <h2>.env 環境變數格式</h2>
      <pre>
VERIFY_TOKEN=your_verify_token_here
      </pre>
    </section>
    <section>
      <h2>webhook.py 程式功能解說</h2>
      <pre>
from flask import Flask, request
import os
from dotenv import load_dotenv

load_dotenv()

VERIFY_TOKEN = os.getenv("VERIFY_TOKEN")
app = Flask(__name__)

REPLIES = {
    "booking": {
        "en": "Thank you for your interest in APA Hotel Woodbridge. You can make a reservation here: https://www.apahotelwoodbridge.com/",
        "ja": "ご予約はこちら：https://www.apahotelwoodbridge.com/",
        "zh": "感謝您聯絡 APA Hotel Woodbridge。訂房請點選：https://www.apahotelwoodbridge.com/"
    },
    "location": {
        "en": "Our address is: 120 Wood Avenue South, Iselin, NJ 08830.",
        "ja": "住所：120 Wood Avenue South, Iselin, NJ 08830。",
        "zh": "地址：120 Wood Avenue South, Iselin, NJ 08830。"
    },
    "checkin": {
        "en": "Check-in time: 3:00 PM / Check-out: 11:00 AM.",
        "ja": "チェックイン：15:00 / チェックアウト：11:00。",
        "zh": "入住時間：下午3點，退房時間：上午11點。"
    }
}

# 偵測語言（簡化方式）
def detect_lang(text):
    if any(word in text.lower() for word in ["的", "請問", "您好"]):
        return "zh"
    elif any(word in text.lower() for word in ["です", "予約", "こんにちは"]):
        return "ja"
    else:
        return "en"

@app.route("/webhook", methods=["GET", "POST"])
def webhook():
    if request.method == "GET":
        token = request.args.get("hub.verify_token")
        challenge = request.args.get("hub.challenge")
        return challenge if token == VERIFY_TOKEN else "Invalid token"

    if request.method == "POST":
        data = request.get_json()
        print("Incoming:", data)

        for entry in data.get("entry", []):
            for messaging in entry.get("messaging", []):
                sender_id = messaging["sender"]["id"]
                message_text = messaging.get("message", {}).get("text", "")
                lang = detect_lang(message_text)

                if "訂房" in message_text or "book" in message_text.lower() or "予約" in message_text:
                    reply_text = REPLIES["booking"][lang]
                elif "地址" in message_text or "address" in message_text.lower():
                    reply_text = REPLIES["location"][lang]
                elif "入住" in message_text or "check-in" in message_text.lower():
                    reply_text = REPLIES["checkin"][lang]
                else:
                    reply_text = {
                        "en": "Thank you! We will get back to you shortly.",
                        "zh": "謝謝您的訊息，我們將盡快回覆。",
                        "ja": "ありがとうございます。すぐに返信いたします。"
                    }[lang]

                send_message(sender_id, reply_text)
        return "OK", 200

def send_message(recipient_id, text):
    print(f"[Bot] ➜ to {recipient_id}: {text}")
    # Meta Graph API 呼叫區（此範例僅打印）

if __name__ == "__main__":
    app.run(debug=True)
      </pre>
    </section>
    <section>
      <h2>部署到 Render</h2>
      <ol>
        <li>將程式 push 至 GitHub Repository</li>
        <li>到 <a href="https://render.com" target="_blank">https://render.com</a> 註冊帳號</li>
        <li>選擇：New &gt; Web Service</li>
        <li>選擇語言：Python + 選擇 GitHub Repo</li>
        <li>設定欄位：
          <ul>
            <li>Start command：<code>gunicorn webhook:app</code></li>
            <li>Secret File：新增 <code>.env</code> 內容</li>
          </ul>
        </li>
        <li>點擊 Deploy</li>
        <li>複製 webhook URL，格式為：https://xxx.onrender.com/webhook</li>
      </ol>
    </section>
    <section>
      <h2>IG / FB 串接設定步驟</h2>
      <h3>IG 必備條件</h3>
      <ul>
        <li>將 IG 帳號升級為商業帳號（專業帳號）</li>
        <li>綁定一個 Facebook 粉專</li>
      </ul>
      <h3>Meta 開發者設定</h3>
      <ol>
        <li>前往 <a href="https://developers.facebook.com/" target="_blank">https://developers.facebook.com/</a></li>
        <li>建立應用程式（類型：企業）</li>
        <li>加入以下產品：
          <ul>
            <li>Instagram Graph API</li>
            <li>Messenger</li>
            <li>Webhooks</li>
          </ul>
        </li>
        <li>Webhook 訂閱：
          <ul>
            <li>訂閱 <code>messages</code> 權限</li>
            <li>填入驗證網址 + verify_token（與程式一致）</li>
          </ul>
        </li>
        <li>設定權杖（使用 Graph API Explorer 取得 Page Access Token）</li>
      </ol>
    </section>
    <section>
      <h2>常見訊息與回覆範本</h2>
      <div class="table-scroll-wrapper">
        <table>
          <thead>
            <tr>
              <th>問題關鍵字</th>
              <th>中文回覆</th>
              <th>英文回覆</th>
              <th>日文回覆</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>訂房</td>
              <td>感謝您聯絡 APA Hotel Woodbridge。訂房請點選：https://www.apahotelwoodbridge.com/</td>
              <td>Thank you for your interest in APA Hotel Woodbridge. You can make a reservation here: https://www.apahotelwoodbridge.com/</td>
              <td>ご予約はこちら：https://www.apahotelwoodbridge.com/</td>
            </tr>
            <tr>
              <td>地址</td>
              <td>地址：120 Wood Avenue South, Iselin, NJ 08830。</td>
              <td>Our address is: 120 Wood Avenue South, Iselin, NJ 08830.</td>
              <td>住所：120 Wood Avenue South, Iselin, NJ 08830。</td>
            </tr>
            <tr>
              <td>入住</td>
              <td>入住時間：下午3點，退房時間：上午11點。</td>
              <td>Check-in time: 3:00 PM / Check-out: 11:00 AM.</td>
              <td>チェックイン：15:00 / チェックアウト：11:00。</td>
            </tr>
            <tr>
              <td>謝謝</td>
              <td>謝謝您的訊息，我們將盡快回覆。</td>
              <td>Thank you! We will get back to you shortly.</td>
              <td>ありがとうございます。すぐに返信いたします。</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    <section>
      <h2>目前進度</h2>
      <ul>
        <li>完成 IG 和 Facebook Messenger 的基本自動回覆功能開發。</li>
        <li>完成多語言（中、英、日）訊息判斷與回覆。</li>
        <li>基礎關鍵字回覆邏輯已完成，包含訂房、地址、入住時間與感謝語。</li>
      </ul>
    </section>
    <section>
      <h2>未完成項目 / 下一步建議</h2>
      <ul>
        <li>Render 部署測試，Webhook 可正常接收訊息。</li>
        <li>增加更多自然語言處理能力，使語言判斷更準確。</li>
        <li>完善 Facebook Graph API 的訊息發送功能，實際回覆使用者。</li>
        <li>加入使用者訊息紀錄功能，方便後續分析與優化。</li>
        <li>擴充更多常見問題的關鍵字與回覆內容。</li>
        <li>設計聊天機器人多輪對話流程，提高互動性。</li>
      </ul>
    </section>
    <footer>
      <p>© 2025 APA Hotel Woodbridge 自動回覆機器人專案</p>
    </footer>
  </div>

  <!-- 英文內容 -->
  <div class="lang-content" id="lang-en">
    <h1>APA Hotel Woodbridge Instagram & Facebook Auto-Reply Bot Technical Documentation</h1>
    <section>
      <h2>Purpose</h2>
      <p>Create a multilingual chatbot that automatically replies to IG and Facebook messages, serving APA Hotel Woodbridge fans and potential customers.</p>
    </section>
    <section>
      <h2>System Features Overview</h2>
      <ul>
        <li>Supported platforms: Instagram + Facebook Messenger</li>
        <li>Language support: Chinese, English, Japanese (automatic detection)</li>
        <li>Features:
          <ul>
            <li>Reply with booking link</li>
            <li>Reply with hotel address</li>
            <li>Reply with check-in/check-out time</li>
            <li>Reply with general thank-you messages</li>
          </ul>
        </li>
      </ul>
    </section>
    <section>
      <h2>Architecture & Technologies</h2>
      <ul>
        <li>Language: Python</li>
        <li>Web framework: Flask</li>
        <li>Server deployment: Render </li>
        <li>Uses Facebook Graph API</li>
        <li>Uses Webhook to receive message events</li>
      </ul>
    </section>
    <section>
      <h2>Project Structure</h2>
      <pre>
project/
├── webhook.py            # Main program
├── .env                  # Environment variables
└── requirements.txt      # Package list (for Render)
      </pre>
    </section>
    <section>
      <h2>.env Environment Variable Format</h2>
      <pre>
VERIFY_TOKEN=your_verify_token_here
      </pre>
    </section>
    <section>
      <h2>webhook.py Code Explanation</h2>
      <pre>
from flask import Flask, request
import os
from dotenv import load_dotenv

load_dotenv()

VERIFY_TOKEN = os.getenv("VERIFY_TOKEN")
app = Flask(__name__)

REPLIES = {
    "booking": {
        "en": "Thank you for your interest in APA Hotel Woodbridge. You can make a reservation here: https://www.apahotelwoodbridge.com/",
        "ja": "ご予約はこちら：https://www.apahotelwoodbridge.com/",
        "zh": "感謝您聯絡 APA Hotel Woodbridge。訂房請點選：https://www.apahotelwoodbridge.com/"
    },
    "location": {
        "en": "Our address is: 120 Wood Avenue South, Iselin, NJ 08830.",
        "ja": "住所：120 Wood Avenue South, Iselin, NJ 08830。",
        "zh": "地址：120 Wood Avenue South, Iselin, NJ 08830。"
    },
    "checkin": {
        "en": "Check-in time: 3:00 PM / Check-out: 11:00 AM.",
        "ja": "チェックイン：15:00 / チェックアウト：11:00。",
        "zh": "入住時間：下午3點，退房時間：上午11點。"
    }
}

# Simple language detection
def detect_lang(text):
    if any(word in text.lower() for word in ["的", "請問", "您好"]):
        return "zh"
    elif any(word in text.lower() for word in ["です", "予約", "こんにちは"]):
        return "ja"
    else:
        return "en"

@app.route("/webhook", methods=["GET", "POST"])
def webhook():
    if request.method == "GET":
        token = request.args.get("hub.verify_token")
        challenge = request.args.get("hub.challenge")
        return challenge if token == VERIFY_TOKEN else "Invalid token"

    if request.method == "POST":
        data = request.get_json()
        print("Incoming:", data)

        for entry in data.get("entry", []):
            for messaging in entry.get("messaging", []):
                sender_id = messaging["sender"]["id"]
                message_text = messaging.get("message", {}).get("text", "")
                lang = detect_lang(message_text)

                if "訂房" in message_text or "book" in message_text.lower() or "予約" in message_text:
                    reply_text = REPLIES["booking"][lang]
                elif "地址" in message_text or "address" in message_text.lower():
                    reply_text = REPLIES["location"][lang]
                elif "入住" in message_text or "check-in" in message_text.lower():
                    reply_text = REPLIES["checkin"][lang]
                else:
                    reply_text = {
                        "en": "Thank you! We will get back to you shortly.",
                        "zh": "謝謝您的訊息，我們將盡快回覆。",
                        "ja": "ありがとうございます。すぐに返信いたします。"
                    }[lang]

                send_message(sender_id, reply_text)
        return "OK", 200

def send_message(recipient_id, text):
    print(f"[Bot] ➜ to {recipient_id}: {text}")
    # Meta Graph API call (this example just prints)

if __name__ == "__main__":
    app.run(debug=True)
      </pre>
    </section>
    <section>
      <h2>Deploy to Render</h2>
      <ol>
        <li>Push the code to your GitHub Repository</li>
        <li>Register on <a href="https://render.com" target="_blank">https://render.com</a></li>
        <li>Select: New &gt; Web Service</li>
        <li>Select language: Python + select your GitHub Repo</li>
        <li>Configure:
          <ul>
            <li>Start command: <code>gunicorn webhook:app</code></li>
            <li>Secret File: add your <code>.env</code> contents</li>
          </ul>
        </li>
        <li>Click Deploy</li>
        <li>Copy the webhook URL, e.g.: https://xxx.onrender.com/webhook</li>
      </ol>
    </section>
    <section>
      <h2>IG / FB Integration Steps</h2>
      <h3>IG Requirements</h3>
      <ul>
        <li>Upgrade your IG account to a Business (Professional) Account</li>
        <li>Bind to a Facebook Page</li>
      </ul>
      <h3>Meta Developer Settings</h3>
      <ol>
        <li>Visit <a href="https://developers.facebook.com/" target="_blank">https://developers.facebook.com/</a></li>
        <li>Create an app (Type: Business)</li>
        <li>Add the following products:
          <ul>
            <li>Instagram Graph API</li>
            <li>Messenger</li>
            <li>Webhooks</li>
          </ul>
        </li>
        <li>Webhook subscription:
          <ul>
            <li>Subscribe to <code>messages</code> permission</li>
            <li>Enter the verification URL + verify_token (same as in your code)</li>
          </ul>
        </li>
        <li>Set up tokens (use Graph API Explorer to get Page Access Token)</li>
      </ol>
    </section>
    <section>
      <h2>Common Message & Reply Samples</h2>
      <div class="table-scroll-wrapper">
        <table>
          <thead>
            <tr>
              <th>Keyword</th>
              <th>Chinese Reply</th>
              <th>English Reply</th>
              <th>Japanese Reply</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Booking</td>
              <td>感謝您聯絡 APA Hotel Woodbridge。訂房請點選：https://www.apahotelwoodbridge.com/</td>
              <td>Thank you for your interest in APA Hotel Woodbridge. You can make a reservation here: https://www.apahotelwoodbridge.com/</td>
              <td>ご予約はこちら：https://www.apahotelwoodbridge.com/</td>
            </tr>
            <tr>
              <td>Address</td>
              <td>地址：120 Wood Avenue South, Iselin, NJ 08830。</td>
              <td>Our address is: 120 Wood Avenue South, Iselin, NJ 08830.</td>
              <td>住所：120 Wood Avenue South, Iselin, NJ 08830。</td>
            </tr>
            <tr>
              <td>Check-in</td>
              <td>入住時間：下午3點，退房時間：上午11點。</td>
              <td>Check-in time: 3:00 PM / Check-out: 11:00 AM.</td>
              <td>チェックイン：15:00 / チェックアウト：11:00。</td>
            </tr>
            <tr>
              <td>Thank you</td>
              <td>謝謝您的訊息，我們將盡快回覆。</td>
              <td>Thank you! We will get back to you shortly.</td>
              <td>ありがとうございます。すぐに返信いたします。</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    <section>
      <h2>Progress</h2>
      <ul>
        <li>Completed basic auto-reply feature for IG and Facebook Messenger.</li>
        <li>Implemented multilingual (Chinese, English, Japanese) message detection and replies.</li>
        <li>Basic keyword reply logic completed, including booking, address, check-in time, and thank-you messages.</li>
      </ul>
    </section>
    <section>
      <h2>Pending Tasks / Next Steps</h2>
      <ul>
        <li>Test deployment on Render, ensure webhook receives messages properly.</li>
        <li>Add more natural language processing capabilities for better language detection.</li>
        <li>Improve Facebook Graph API message sending for real user replies.</li>
        <li>Add user message logging for future analysis and optimization.</li>
        <li>Expand more common Q&A keywords and replies.</li>
        <li>Design multi-turn conversation flow for more interactive chatbot.</li>
      </ul>
    </section>
    <footer>
      <p>© 2025 APA Hotel Woodbridge Auto-Reply Bot Project</p>
    </footer>
  </div>
  <!-- 日文內容 -->
  <div class="lang-content" id="lang-jp">
    <h1>APAホテルウッドブリッジ Instagram & Facebook 自動応答ボット技術ドキュメント</h1>
    <section>
      <h2>目的</h2>
      <p>APAホテルウッドブリッジのファンや潜在顧客向けに、IGとFacebookのメッセージに自動返信する多言語チャットボットを作成します。</p>
    </section>
    <section>
      <h2>システム機能概要</h2>
      <ul>
        <li>対応プラットフォーム：Instagram + Facebook Messenger</li>
        <li>対応言語：中国語、英語、日本語（自動判別）</li>
        <li>主な機能：
          <ul>
            <li>予約リンクの返信</li>
            <li>ホテル住所の返信</li>
            <li>チェックイン／チェックアウト時間の返信</li>
            <li>感謝メッセージの返信</li>
          </ul>
        </li>
      </ul>
    </section>
    <section>
      <h2>構成と技術</h2>
      <ul>
        <li>使用言語：Python</li>
        <li>ウェブフレームワーク：Flask</li>
        <li>サーバー配備：Render</li>
        <li>Facebook Graph API を利用</li>
        <li>Webhookでメッセージイベントを受信</li>
      </ul>
    </section>
    <section>
      <h2>ファイル構造</h2>
      <pre>
project/
├── webhook.py            # メインプログラム
├── .env                  # 環境変数
└── requirements.txt      # パッケージリスト（Render用）
      </pre>
    </section>
    <section>
      <h2>.env 環境変数フォーマット</h2>
      <pre>
VERIFY_TOKEN=your_verify_token_here
      </pre>
    </section>
    <section>
      <h2>webhook.py コード説明</h2>
      <pre>
from flask import Flask, request
import os
from dotenv import load_dotenv

load_dotenv()

VERIFY_TOKEN = os.getenv("VERIFY_TOKEN")
app = Flask(__name__)

REPLIES = {
    "booking": {
        "en": "Thank you for your interest in APA Hotel Woodbridge. You can make a reservation here: https://www.apahotelwoodbridge.com/",
        "ja": "ご予約はこちら：https://www.apahotelwoodbridge.com/",
        "zh": "感謝您聯絡 APA Hotel Woodbridge。訂房請點選：https://www.apahotelwoodbridge.com/"
    },
    "location": {
        "en": "Our address is: 120 Wood Avenue South, Iselin, NJ 08830.",
        "ja": "住所：120 Wood Avenue South, Iselin, NJ 08830。",
        "zh": "地址：120 Wood Avenue South, Iselin, NJ 08830。"
    },
    "checkin": {
        "en": "Check-in time: 3:00 PM / Check-out: 11:00 AM.",
        "ja": "チェックイン：15:00 / チェックアウト：11:00。",
        "zh": "入住時間：下午3點，退房時間：上午11點。"
    }
}

# 簡易言語判定
def detect_lang(text):
    if any(word in text.lower() for word in ["的", "請問", "您好"]):
        return "zh"
    elif any(word in text.lower() for word in ["です", "予約", "こんにちは"]):
        return "ja"
    else:
        return "en"

@app.route("/webhook", methods=["GET", "POST"])
def webhook():
    if request.method == "GET":
        token = request.args.get("hub.verify_token")
        challenge = request.args.get("hub.challenge")
        return challenge if token == VERIFY_TOKEN else "Invalid token"

    if request.method == "POST":
        data = request.get_json()
        print("Incoming:", data)

        for entry in data.get("entry", []):
            for messaging in entry.get("messaging", []):
                sender_id = messaging["sender"]["id"]
                message_text = messaging.get("message", {}).get("text", "")
                lang = detect_lang(message_text)

                if "訂房" in message_text or "book" in message_text.lower() or "予約" in message_text:
                    reply_text = REPLIES["booking"][lang]
                elif "地址" in message_text or "address" in message_text.lower():
                    reply_text = REPLIES["location"][lang]
                elif "入住" in message_text or "check-in" in message_text.lower():
                    reply_text = REPLIES["checkin"][lang]
                else:
                    reply_text = {
                        "en": "Thank you! We will get back to you shortly.",
                        "zh": "謝謝您的訊息，我們將盡快回覆。",
                        "ja": "ありがとうございます。すぐに返信いたします。"
                    }[lang]

                send_message(sender_id, reply_text)
        return "OK", 200

def send_message(recipient_id, text):
    print(f"[Bot] ➜ to {recipient_id}: {text}")
    # Meta Graph API呼び出し（例：今回はprintのみ）

if __name__ == "__main__":
    app.run(debug=True)
      </pre>
    </section>
    <section>
      <h2>Render へのデプロイ</h2>
      <ol>
        <li>プログラムをGitHubリポジトリにpush</li>
        <li><a href="https://render.com" target="_blank">https://render.com</a> でアカウント登録</li>
        <li>New &gt; Web Service を選択</li>
        <li>言語はPythonを選択し、GitHubリポジトリを指定</li>
        <li>設定項目：
          <ul>
            <li>Start command：<code>gunicorn webhook:app</code></li>
            <li>Secret File：<code>.env</code>内容を追加</li>
          </ul>
        </li>
        <li>Deployをクリック</li>
        <li>Webhook URLをコピー（例：https://xxx.onrender.com/webhook）</li>
      </ol>
    </section>
    <section>
      <h2>IG / FB 連携手順</h2>
      <h3>IG 必須条件</h3>
      <ul>
        <li>IGアカウントをビジネス（プロ）アカウントへアップグレード</li>
        <li>Facebookページと連携</li>
      </ul>
      <h3>Meta開発者設定</h3>
      <ol>
        <li><a href="https://developers.facebook.com/" target="_blank">https://developers.facebook.com/</a> にアクセス</li>
        <li>アプリを作成（種類：ビジネス）</li>
        <li>以下のプロダクトを追加：
          <ul>
            <li>Instagram Graph API</li>
            <li>Messenger</li>
            <li>Webhooks</li>
          </ul>
        </li>
        <li>Webhook購読：
          <ul>
            <li><code>messages</code>パーミッションを購読</li>
            <li>検証URL＋verify_token（プログラムと同じ値）を入力</li>
          </ul>
        </li>
        <li>トークン設定（Graph API ExplorerでPage Access Token取得）</li>
      </ol>
    </section>
    <section>
      <h2>よくあるメッセージと返信例</h2>
      <div class="table-scroll-wrapper">
        <table>
          <thead>
            <tr>
              <th>キーワード</th>
              <th>中国語の返信</th>
              <th>英語の返信</th>
              <th>日本語の返信</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>予約</td>
              <td>感謝您聯絡 APA Hotel Woodbridge。訂房請點選：https://www.apahotelwoodbridge.com/</td>
              <td>Thank you for your interest in APA Hotel Woodbridge. You can make a reservation here: https://www.apahotelwoodbridge.com/</td>
              <td>ご予約はこちら：https://www.apahotelwoodbridge.com/</td>
            </tr>
            <tr>
              <td>住所</td>
              <td>地址：120 Wood Avenue South, Iselin, NJ 08830。</td>
              <td>Our address is: 120 Wood Avenue South, Iselin, NJ 08830.</td>
              <td>住所：120 Wood Avenue South, Iselin, NJ 08830。</td>
            </tr>
            <tr>
              <td>チェックイン</td>
              <td>入住時間：下午3點，退房時間：上午11點。</td>
              <td>Check-in time: 3:00 PM / Check-out: 11:00 AM.</td>
              <td>チェックイン：15:00 / チェックアウト：11:00。</td>
            </tr>
            <tr>
              <td>ありがとう</td>
              <td>謝謝您的訊息，我們將盡快回覆。</td>
              <td>Thank you! We will get back to you shortly.</td>
              <td>ありがとうございます。すぐに返信いたします。</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    <section>
      <h2>進捗状況</h2>
      <ul>
        <li>IGとFacebook Messengerの基本自動応答機能の開発を完了。</li>
        <li>多言語（中・英・日）メッセージ判定と返信を実装。</li>
        <li>予約・住所・チェックイン時間・感謝語の基本キーワード返信ロジック完成。</li>
      </ul>
    </section>
    <section>
      <h2>未完了項目／今後の提案</h2>
      <ul>
        <li>Renderでの配備テストとWebhookの正常受信確認。</li>
        <li>より高精度な自然言語処理での言語判別機能追加。</li>
        <li>Facebook Graph APIでのユーザー実応答機能強化。</li>
        <li>ユーザーメッセージログ機能追加による分析性向上。</li>
        <li>よくある質問のキーワード・返信内容拡充。</li>
        <li>多段階対話の設計によるチャットボットの対話性向上。</li>
      </ul>
    </section>
    <footer>
      <p>© 2025 APAホテルウッドブリッジ 自動応答ボットプロジェクト</p>
    </footer>
  </div>

  <!-- 語言切換腳本 -->
  <script>
    const tabs = document.querySelectorAll('.lang-tab');
    const contents = document.querySelectorAll('.lang-content');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        contents.forEach(c => c.classList.remove('active'));
        document.getElementById('lang-' + tab.dataset.lang).classList.add('active');
      });
    });
  </script>
</body>
</html>
